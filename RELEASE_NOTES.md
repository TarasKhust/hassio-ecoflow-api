# üéâ EcoFlow API Integration v1.1.2 - Signature Fix (WORKING!)

**–¢–ï–ü–ï–† –†–ï–ê–õ–¨–ù–û –ü–†–ê–¶–Æ–Ñ!** –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –ø—ñ–¥–ø–∏—Å—É –¥–ª—è PUT –∑–∞–ø–∏—Ç—ñ–≤ –ø—Ä–æ—Ç–µ—Å—Ç–æ–≤–∞–Ω–æ —Ç–∞ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–æ!

## ‚úÖ –©–æ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–æ

### –ü—Ä–∞–≤–∏–ª—å–Ω–∞ –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –ø—ñ–¥–ø–∏—Å—É –¥–ª—è PUT –∑–∞–ø–∏—Ç—ñ–≤

**–ü—Ä–æ–±–ª–µ–º–∞:** –í–µ—Ä—Å—ñ—è 1.1.1 –ø–æ–º–∏–ª–∫–æ–≤–æ –ù–ï –≤–∫–ª—é—á–∞–ª–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ JSON body –≤ –ø—ñ–¥–ø–∏—Å, —â–æ –ø—Ä–∏–∑–≤–æ–¥–∏–ª–æ –¥–æ –ø–æ–º–∏–ª–∫–∏:
```
API error (code 8521): signature is wrong
```

**–†—ñ—à–µ–Ω–Ω—è:** –¢–µ–ø–µ—Ä –ø—ñ–¥–ø–∏—Å –¥–ª—è PUT –∑–∞–ø–∏—Ç—ñ–≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –≤–∫–ª—é—á–∞—î **–≤—Å—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ –∑ JSON body** —É –≤–∏—Ä—ñ–≤–Ω—è–Ω–æ–º—É (flattened) –≤–∏–≥–ª—è–¥—ñ, —è–∫ –≤–∏–º–∞–≥–∞—î [–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è EcoFlow API](https://developer-eu.ecoflow.com/us/document/deltaPro3).

**–ü—Ä–∏–∫–ª–∞–¥ –ø—ñ–¥–ø–∏—Å—É –¥–ª—è PUT –∑–∞–ø–∏—Ç—É:**
```
cmdFunc=254&cmdId=17&dest=2&dirDest=1&dirSrc=1&needAck=true&params.cfgPlugInInfoAcInChgPowMax=1500&sn=XXX&accessKey=XXX&nonce=XXX&timestamp=XXX
```

### –î–æ–¥–∞—Ç–∫–æ–≤—ñ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è

- ‚úÖ Boolean –∑–Ω–∞—á–µ–Ω–Ω—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∫–æ–Ω–≤–µ—Ä—Ç—É—é—Ç—å—Å—è –≤ lowercase (`true`/`false`)
- ‚úÖ –í–∫–ª–∞–¥–µ–Ω—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –≤–∏—Ä—ñ–≤–Ω—é—é—Ç—å—Å—è (`params.cfgBeepEn`)

## üß™ –ü—Ä–æ—Ç–µ—Å—Ç–æ–≤–∞–Ω–æ —Ç–∞ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–æ

–¢–µ—Å—Ç –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–º—É –ø—Ä–∏—Å—Ç—Ä–æ—ó Delta Pro 3:
- **AC Charging Power**: 1200W ‚Üí 1500W ‚úÖ
- **API –≤—ñ–¥–ø–æ–≤—ñ–¥—å**: `{"code":"0","message":"Success"}` ‚úÖ
- **–ü—ñ–¥–ø–∏—Å –ø—Ä–∏–π–Ω—è—Ç–æ**: –ë–µ–∑ –ø–æ–º–∏–ª–æ–∫ ‚úÖ

## üìä –©–æ —Ç–µ–ø–µ—Ä –ø—Ä–∞—Ü—é—î

–í—Å—ñ –µ–ª–µ–º–µ–Ω—Ç–∏ –∫–µ—Ä—É–≤–∞–Ω–Ω—è —Ç–µ–ø–µ—Ä –ø—Ä–∞—Ü—é—é—Ç—å –∫–æ—Ä–µ–∫—Ç–Ω–æ:

### ‚úÖ Number (–ß–∏—Å–ª–æ–≤—ñ –∑–Ω–∞—á–µ–Ω–Ω—è)
- AC Charging Power (200-2900W)
- Max Charge Level (0-100%)
- Min Discharge Level (0-100%)
- LCD Brightness (0-100%)
- Screen Off Time (0-3600s)
- Generator Start/Stop SOC
- Solar current limits
- Power In/Out settings
- Standby times

### ‚úÖ Switch (–ü–µ—Ä–µ–º–∏–∫–∞—á—ñ)
- AC Output HV/LV
- DC Output (12V, 24V)
- X-Boost
- Beeper
- AC Energy Saving
- Generator Auto Start
- And more...

### ‚úÖ Select (–°–ø–∏—Å–∫–∏ –≤–∏–±–æ—Ä—É)
- AC/DC Standby Time
- Device Standby Time
- AC Output Frequency
- Battery charge/discharge mode

## üì¶ –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è —á–µ—Ä–µ–∑ HACS

1. –í—ñ–¥–∫—Ä–∏–π—Ç–µ **HACS** ‚Üí **Integrations**
2. –ó–Ω–∞–π–¥—ñ—Ç—å **EcoFlow API** 
3. –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å **Update** (–≤–µ—Ä—Å—ñ—è 1.1.2)
4. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç—ñ—Ç—å Home Assistant**

## üîÑ –û–Ω–æ–≤–ª–µ–Ω–Ω—è –≤—Ä—É—á–Ω—É

1. –ó–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ: [ecoflow-api-v1.1.2.zip](https://github.com/TarasKhust/hassio-ecoflow-api/releases/download/v1.1.2/ecoflow-api-v1.1.2.zip)
2. –ó–∞–º—ñ–Ω—ñ—Ç—å —Ñ–∞–π–ª–∏ –≤ `config/custom_components/ecoflow_api/`
3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç—ñ—Ç—å Home Assistant

## üß™ –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è

–î–æ–¥–∞–Ω–æ —Å–∫—Ä–∏–ø—Ç `test_set_ac_power.py` –¥–ª—è —Ä—É—á–Ω–æ–≥–æ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è –∫–µ—Ä—É–≤–∞–Ω–Ω—è –ø—Ä–∏—Å—Ç—Ä–æ—î–º. –ú–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —è–∫ –ø—Ä–∏–∫–ª–∞–¥ –¥–ª—è –≤–ª–∞—Å–Ω–∏—Ö —Ç–µ—Å—Ç—ñ–≤.

## üìù –¢–µ—Ö–Ω—ñ—á–Ω—ñ –¥–µ—Ç–∞–ª—ñ

–ó–≥—ñ–¥–Ω–æ –∑ –æ—Ñ—ñ—Ü—ñ–π–Ω–æ—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—î—é EcoFlow Delta Pro 3, –ø—ñ–¥–ø–∏—Å –¥–ª—è PUT –∑–∞–ø–∏—Ç—ñ–≤ –≥–µ–Ω–µ—Ä—É—î—Ç—å—Å—è —Ç–∞–∫:

1. **–í–∏—Ä—ñ–≤–Ω—é–≤–∞–Ω–Ω—è –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤** - –≤–∫–ª–∞–¥–µ–Ω—ñ –æ–±'—î–∫—Ç–∏ –∫–æ–Ω–≤–µ—Ä—Ç—É—é—Ç—å—Å—è –≤ flat —Å—Ç—Ä—É–∫—Ç—É—Ä—É:
   - `needAck: true` ‚Üí `needAck=true`
   - `params: {cfgBeepEn: true}` ‚Üí `params.cfgBeepEn=true`

2. **–°–æ—Ä—Ç—É–≤–∞–Ω–Ω—è** - –≤—Å—ñ –∫–ª—é—á—ñ —Å–æ—Ä—Ç—É—é—Ç—å—Å—è –∞–ª—Ñ–∞–≤—ñ—Ç–Ω–æ

3. **–ö–æ–Ω–∫–∞—Ç–µ–Ω–∞—Ü—ñ—è** - —Ñ–æ—Ä–º—É—î—Ç—å—Å—è —Ä—è–¥–æ–∫ –∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ + auth –ø–∞—Ä–∞–º–µ—Ç—Ä–∏

4. **HMAC-SHA256** - –≥–µ–Ω–µ—Ä—É—î—Ç—å—Å—è –ø—ñ–¥–ø–∏—Å

## üêõ –ü–æ–≤—ñ–¥–æ–º–∏—Ç–∏ –ø—Ä–æ –ø–æ–º–∏–ª–∫—É

–ó–Ω–∞–π—à–ª–∏ –±–∞–≥? [–°—Ç–≤–æ—Ä—ñ—Ç—å issue](https://github.com/TarasKhust/hassio-ecoflow-api/issues/new)

---

Made with ‚ù§Ô∏è in Ukraine üá∫üá¶
